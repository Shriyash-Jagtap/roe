-- Retail Sales Data
CREATE TABLE retail_data (
  Store_ID TEXT,
  Footfall INTEGER,
  Promo_Spend INTEGER,
  Avg_Basket INTEGER,
  Returns INTEGER,
  Net_Sales INTEGER
);

INSERT INTO retail_data VALUES ('S19', 995, 2805, 94, 8, 94562);
INSERT INTO retail_data VALUES ('S04', 199, 1099, 21, 4, 4377);
INSERT INTO retail_data VALUES ('S10', 199, 882, 40, 7, 7935);
INSERT INTO retail_data VALUES ('S07', 420, 590, 67, 10, 28108);
INSERT INTO retail_data VALUES ('S09', 609, 1974, 48, 3, 29952);
INSERT INTO retail_data VALUES ('S13', 747, 2095, 32, 5, 24717);
INSERT INTO retail_data VALUES ('S02', 816, 2193, 83, 2, 68938);
INSERT INTO retail_data VALUES ('S15', 294, 834, 24, 2, 7301);
INSERT INTO retail_data VALUES ('S03', 682, 2456, 59, 4, 41409);
INSERT INTO retail_data VALUES ('S10', 427, 2741, 70, 2, 31276);
INSERT INTO retail_data VALUES ('S02', 758, 1892, 78, 1, 60235);
INSERT INTO retail_data VALUES ('S20', 983, 1981, 79, 5, 78620);
INSERT INTO retail_data VALUES ('S17', 187, 559, 82, 4, 15342);
INSERT INTO retail_data VALUES ('S03', 972, 1987, 36, 9, 35421);
INSERT INTO retail_data VALUES ('S16', 616, 2585, 28, 6, 18151);
INSERT INTO retail_data VALUES ('S08', 548, 839, 34, 0, 19265);
INSERT INTO retail_data VALUES ('S12', 197, 1607, 30, 5, 6657);
INSERT INTO retail_data VALUES ('S05', 759, 1813, 38, 9, 29148);
INSERT INTO retail_data VALUES ('S12', 906, 685, 60, 8, 54163);
INSERT INTO retail_data VALUES ('S02', 566, 2756, 43, 4, 25322);
INSERT INTO retail_data VALUES ('S15', 834, 1930, 61, 3, 51475);
INSERT INTO retail_data VALUES ('S11', 638, 2151, 80, 8, 51776);
INSERT INTO retail_data VALUES ('S11', 348, 1242, 35, 5, 12556);
INSERT INTO retail_data VALUES ('S11', 668, 1807, 73, 1, 49776);
INSERT INTO retail_data VALUES ('S11', 960, 1065, 71, 9, 68211);
INSERT INTO retail_data VALUES ('S05', 249, 1228, 84, 3, 21574);
INSERT INTO retail_data VALUES ('S15', 901, 772, 51, 2, 45991);
INSERT INTO retail_data VALUES ('S06', 389, 1185, 75, 2, 29748);
INSERT INTO retail_data VALUES ('S01', 758, 2837, 73, 7, 56456);
INSERT INTO retail_data VALUES ('S06', 514, 2186, 92, 10, 47654);
INSERT INTO retail_data VALUES ('S02', 547, 679, 88, 3, 48272);
INSERT INTO retail_data VALUES ('S17', 830, 1125, 100, 4, 83455);
INSERT INTO retail_data VALUES ('S17', 350, 2057, 45, 8, 16221);
INSERT INTO retail_data VALUES ('S08', 183, 1791, 43, 3, 8696);
INSERT INTO retail_data VALUES ('S06', 921, 1977, 25, 3, 23634);
INSERT INTO retail_data VALUES ('S20', 633, 1315, 85, 2, 54345);
INSERT INTO retail_data VALUES ('S08', 462, 1022, 58, 1, 27205);
INSERT INTO retail_data VALUES ('S04', 598, 2188, 45, 1, 28081);
INSERT INTO retail_data VALUES ('S20', 530, 621, 74, 10, 39120);
INSERT INTO retail_data VALUES ('S11', 484, 1932, 64, 1, 32134);
INSERT INTO retail_data VALUES ('S09', 298, 2375, 91, 8, 27728);
INSERT INTO retail_data VALUES ('S06', 517, 2889, 51, 3, 27771);
INSERT INTO retail_data VALUES ('S08', 951, 952, 21, 3, 20494);
INSERT INTO retail_data VALUES ('S09', 740, 1444, 51, 6, 38376);
INSERT INTO retail_data VALUES ('S13', 742, 1081, 85, 3, 63666);
INSERT INTO retail_data VALUES ('S07', 660, 2903, 44, 4, 30285);
INSERT INTO retail_data VALUES ('S16', 828, 574, 66, 2, 54646);
INSERT INTO retail_data VALUES ('S12', 381, 2511, 54, 1, 21674);
INSERT INTO retail_data VALUES ('S19', 726, 1484, 100, 3, 73357);
INSERT INTO retail_data VALUES ('S03', 242, 1747, 57, 1, 14838);
INSERT INTO retail_data VALUES ('S17', 108, 1616, 62, 6, 7269);
INSERT INTO retail_data VALUES ('S06', 926, 2967, 28, 10, 26806);
INSERT INTO retail_data VALUES ('S10', 990, 747, 74, 7, 73438);
INSERT INTO retail_data VALUES ('S14', 157, 2689, 46, 10, 8058);
INSERT INTO retail_data VALUES ('S04', 462, 618, 70, 5, 32189);
INSERT INTO retail_data VALUES ('S15', 718, 653, 33, 3, 24104);
INSERT INTO retail_data VALUES ('S19', 920, 665, 49, 7, 45297);
INSERT INTO retail_data VALUES ('S06', 511, 1555, 45, 9, 23259);
INSERT INTO retail_data VALUES ('S11', 852, 1990, 70, 4, 60351);
INSERT INTO retail_data VALUES ('S07', 129, 2895, 51, 5, 7993);
INSERT INTO retail_data VALUES ('S15', 455, 2548, 99, 1, 46246);
INSERT INTO retail_data VALUES ('S10', 897, 2176, 52, 1, 47929);
INSERT INTO retail_data VALUES ('S19', 957, 1657, 84, 4, 81101);
INSERT INTO retail_data VALUES ('S06', 309, 916, 30, 5, 9549);
INSERT INTO retail_data VALUES ('S20', 850, 2049, 38, 1, 33230);
INSERT INTO retail_data VALUES ('S09', 730, 2177, 30, 2, 22666);
INSERT INTO retail_data VALUES ('S11', 177, 2479, 60, 5, 11561);
INSERT INTO retail_data VALUES ('S12', 554, 890, 90, 9, 49728);
INSERT INTO retail_data VALUES ('S08', 911, 2597, 29, 5, 27543);
INSERT INTO retail_data VALUES ('S03', 170, 1998, 81, 6, 14486);
INSERT INTO retail_data VALUES ('S18', 560, 2354, 59, 0, 34077);
INSERT INTO retail_data VALUES ('S02', 554, 1572, 61, 7, 34352);
INSERT INTO retail_data VALUES ('S04', 184, 2717, 99, 9, 19161);
INSERT INTO retail_data VALUES ('S08', 666, 1534, 80, 7, 53530);
INSERT INTO retail_data VALUES ('S20', 430, 1807, 55, 7, 24386);
INSERT INTO retail_data VALUES ('S13', 323, 991, 36, 2, 12216);
INSERT INTO retail_data VALUES ('S08', 868, 2058, 30, 3, 26730);
INSERT INTO retail_data VALUES ('S20', 356, 1173, 85, 4, 30664);
INSERT INTO retail_data VALUES ('S14', 973, 2711, 23, 1, 23675);
INSERT INTO retail_data VALUES ('S01', 545, 1381, 34, 6, 18937);
INSERT INTO retail_data VALUES ('S19', 821, 2749, 29, 3, 24803);
INSERT INTO retail_data VALUES ('S12', 272, 2330, 61, 7, 17515);
INSERT INTO retail_data VALUES ('S14', 264, 985, 74, 4, 19774);
INSERT INTO retail_data VALUES ('S14', 745, 2393, 56, 5, 42553);
INSERT INTO retail_data VALUES ('S02', 852, 734, 39, 6, 33474);
INSERT INTO retail_data VALUES ('S17', 636, 685, 57, 8, 36149);
INSERT INTO retail_data VALUES ('S20', 502, 2370, 44, 7, 22799);
INSERT INTO retail_data VALUES ('S10', 446, 1308, 37, 4, 16991);
INSERT INTO retail_data VALUES ('S04', 255, 886, 28, 1, 7661);
INSERT INTO retail_data VALUES ('S14', 126, 1238, 82, 9, 10425);
INSERT INTO retail_data VALUES ('S11', 995, 1097, 68, 7, 67934);
INSERT INTO retail_data VALUES ('S08', 281, 1982, 63, 5, 18302);
INSERT INTO retail_data VALUES ('S13', 204, 1285, 62, 4, 12889);
INSERT INTO retail_data VALUES ('S19', 735, 2452, 53, 6, 39795);
INSERT INTO retail_data VALUES ('S08', 712, 2998, 47, 10, 34596);
INSERT INTO retail_data VALUES ('S20', 886, 1669, 23, 7, 20684);
INSERT INTO retail_data VALUES ('S02', 789, 1807, 23, 8, 18899);
INSERT INTO retail_data VALUES ('S05', 191, 1778, 98, 5, 19189);
INSERT INTO retail_data VALUES ('S03', 620, 2613, 32, 6, 20666);
INSERT INTO retail_data VALUES ('S11', 715, 2177, 41, 5, 29941);
INSERT INTO retail_data VALUES ('S03', 602, 851, 52, 6, 31524);
INSERT INTO retail_data VALUES ('S08', 263, 560, 73, 9, 19277);
INSERT INTO retail_data VALUES ('S17', 319, 2978, 77, 6, 25790);
INSERT INTO retail_data VALUES ('S04', 932, 576, 67, 3, 62712);
INSERT INTO retail_data VALUES ('S15', 828, 1503, 86, 3, 72056);
INSERT INTO retail_data VALUES ('S09', 114, 1773, 77, 3, 9508);
INSERT INTO retail_data VALUES ('S02', 318, 2647, 34, 4, 12024);
INSERT INTO retail_data VALUES ('S18', 320, 1958, 28, 4, 9517);
INSERT INTO retail_data VALUES ('S14', 840, 1033, 36, 8, 30356);
INSERT INTO retail_data VALUES ('S03', 573, 524, 63, 2, 36100);
INSERT INTO retail_data VALUES ('S20', 968, 1770, 71, 3, 69232);
INSERT INTO retail_data VALUES ('S10', 700, 617, 90, 7, 62923);
INSERT INTO retail_data VALUES ('S05', 757, 1418, 90, 0, 68742);
INSERT INTO retail_data VALUES ('S17', 406, 1885, 38, 7, 16229);
INSERT INTO retail_data VALUES ('S09', 451, 1148, 38, 9, 17073);
INSERT INTO retail_data VALUES ('S10', 562, 2300, 84, 5, 48186);
INSERT INTO retail_data VALUES ('S03', 378, 2877, 54, 3, 21582);
INSERT INTO retail_data VALUES ('S14', 859, 1587, 40, 5, 34965);
INSERT INTO retail_data VALUES ('S10', 432, 2712, 70, 6, 31111);
INSERT INTO retail_data VALUES ('S03', 252, 1392, 60, 3, 15848);
INSERT INTO retail_data VALUES ('S02', 182, 2984, 50, 2, 10559);
INSERT INTO retail_data VALUES ('S10', 284, 2761, 52, 8, 15754);
INSERT INTO retail_data VALUES ('S09', 609, 1217, 90, 3, 55316);
INSERT INTO retail_data VALUES ('S10', 368, 1189, 88, 1, 32766);
INSERT INTO retail_data VALUES ('S15', 344, 617, 73, 4, 25242);
INSERT INTO retail_data VALUES ('S19', 663, 2653, 39, 1, 27355);
INSERT INTO retail_data VALUES ('S05', 729, 559, 60, 3, 43756);
INSERT INTO retail_data VALUES ('S19', 787, 1342, 80, 6, 63440);
INSERT INTO retail_data VALUES ('S17', 483, 798, 87, 2, 42301);
INSERT INTO retail_data VALUES ('S15', 802, 2161, 22, 5, 18294);
INSERT INTO retail_data VALUES ('S15', 588, 1950, 40, 8, 23994);
INSERT INTO retail_data VALUES ('S03', 891, 1943, 74, 4, 66521);
INSERT INTO retail_data VALUES ('S02', 808, 2209, 79, 7, 64591);
INSERT INTO retail_data VALUES ('S14', 630, 1110, 50, 5, 31867);

-- Calculate correlation coefficients
WITH stats AS (
  SELECT 
    COUNT(*) as n,
    AVG(CAST(Promo_Spend AS REAL)) as mean_promo,
    AVG(CAST(Avg_Basket AS REAL)) as mean_basket,
    AVG(CAST(Net_Sales AS REAL)) as mean_sales
  FROM retail_data
),
correlations AS (
  SELECT 
    -- Promo_Spend vs Avg_Basket correlation
    (SUM((Promo_Spend - mean_promo) * (Avg_Basket - mean_basket)) / 
     (SQRT(SUM((Promo_Spend - mean_promo) * (Promo_Spend - mean_promo))) * 
      SQRT(SUM((Avg_Basket - mean_basket) * (Avg_Basket - mean_basket))))) as corr_promo_basket,
    
    -- Promo_Spend vs Net_Sales correlation  
    (SUM((Promo_Spend - mean_promo) * (Net_Sales - mean_sales)) / 
     (SQRT(SUM((Promo_Spend - mean_promo) * (Promo_Spend - mean_promo))) * 
      SQRT(SUM((Net_Sales - mean_sales) * (Net_Sales - mean_sales))))) as corr_promo_sales,
    
    -- Avg_Basket vs Net_Sales correlation
    (SUM((Avg_Basket - mean_basket) * (Net_Sales - mean_sales)) / 
     (SQRT(SUM((Avg_Basket - mean_basket) * (Avg_Basket - mean_basket))) * 
      SQRT(SUM((Net_Sales - mean_sales) * (Net_Sales - mean_sales))))) as corr_basket_sales
  FROM retail_data, stats
)
SELECT 
  'Promo_Spend - Avg_Basket' as pair, 
  ROUND(corr_promo_basket, 6) as correlation,
  ABS(ROUND(corr_promo_basket, 6)) as abs_correlation
FROM correlations
UNION ALL
SELECT 
  'Promo_Spend - Net_Sales' as pair, 
  ROUND(corr_promo_sales, 6) as correlation,
  ABS(ROUND(corr_promo_sales, 6)) as abs_correlation
FROM correlations  
UNION ALL
SELECT 
  'Avg_Basket - Net_Sales' as pair, 
  ROUND(corr_basket_sales, 6) as correlation,
  ABS(ROUND(corr_basket_sales, 6)) as abs_correlation
FROM correlations
ORDER BY abs_correlation DESC;